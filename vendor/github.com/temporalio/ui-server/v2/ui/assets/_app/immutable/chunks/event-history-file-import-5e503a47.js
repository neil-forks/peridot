import{S as $,i as k,s as w,k as C,a as I,w as N,l as U,c as F,x as T,n as g,b as y,y as x,R as A,f as B,t as J,h as b,z as q,J as h,q as G,r as H}from"./index-b87195f7.js";import{d as O}from"./route-for-0206cbc8.js";import{g as R}from"./navigation-25d95d4b.js";import{B as j}from"./button-6ddd3776.js";import{t as z}from"./index-fdaba712.js";import{t as S}from"./toaster-e341d18b.js";import{i as L,a as P}from"./import-events-04bafb9c.js";import{p as W}from"./parse-with-big-int-0036a80a.js";import{g as D}from"./index-6b02b8c4.js";import{p as K}from"./stores-450871c1.js";import{a as M}from"./auth-user-60d5655d.js";import{l as Q}from"./namespaces-f9986fb4.js";function V(r){let o;return{c(){o=G("Import")},l(e){o=H(e,"Import")},m(e,s){y(e,o,s)},d(e){e&&b(o)}}}function X(r){let o,e,s,c,p,a;return s=new j({props:{icon:"file-upload",disabled:!r[0],$$slots:{default:[V]},$$scope:{ctx:r}}}),s.$on("click",r[2]),{c(){o=C("input"),e=I(),N(s.$$.fragment),this.h()},l(t){o=U(t,"INPUT",{class:!0,type:!0,accept:!0}),e=F(t),T(s.$$.fragment,t),this.h()},h(){g(o,"class","import-input block rounded-md border border-gray-200 p-2"),g(o,"type","file"),g(o,"accept",".json")},m(t,i){y(t,o,i),y(t,e,i),x(s,t,i),c=!0,p||(a=A(o,"change",r[1]),p=!0)},p(t,[i]){const f={};i&1&&(f.disabled=!t[0]),i&128&&(f.$$scope={dirty:i,ctx:t}),s.$set(f)},i(t){c||(B(s.$$.fragment,t),c=!0)},o(t){J(s.$$.fragment,t),c=!1},d(t){t&&b(o),t&&b(e),q(s,t),p=!1,a()}}}function Y(r,o,e){let s,c,p;h(r,Q,n=>e(4,s=n)),h(r,M,n=>e(5,c=n)),h(r,K,n=>e(6,p=n));let a,t=!1;return[t,async n=>{var l;const m=n.target,d=(l=m==null?void 0:m.files)===null||l===void 0?void 0:l[0],u=new FileReader;d&&(u.readAsText(d),u.onload=()=>{var _,v;try{const E=(v=(_=u==null?void 0:u.result)===null||_===void 0?void 0:_.toString())!==null&&v!==void 0?v:"";a=W(E),e(0,t=!0)}catch{S.push({variant:"error",message:"Could not parse JSON"}),e(0,t=!1)}})},async()=>{const{settings:n}=p.data;try{const l=await z({response:Array.isArray(a)?a:a==null?void 0:a.events,namespace:s,settings:n,accessToken:c.accessToken}),m=D(l);L.set(l),P.set(m),e(0,t=!1);const d=O(s,"feed");R(d)}catch(l){console.error(l),S.push({variant:"error",message:"Could not create event history from JSON"})}}]}class mt extends ${constructor(o){super(),k(this,o,Y,X,w,{})}}export{mt as E};
